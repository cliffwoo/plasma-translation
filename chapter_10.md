## 示例程序

去中心化应用可以被重新定义为一个MapReduce问题，并使用基于代币的激励机制来保证其正确运行。

### 10.1 基于区块链的Reddit克隆

该应用主要是在区块链上完成数据存储(CRUD)相关功能。主要的计算和验证都围绕着访问控制，身份识别(投票或者发帖)以及审核进行。多数的Web应用程序都是类似的只在后端进行CRUD操作。

在根链中包括共识规则和欺诈检验的智能合约。在最顶层的父节点中包含各个子版块(subreddits)的账户。每个子版块都是父节点的一个子节点，并且是一个Plasma链。每个子版块都是一个由帖子组成的Plasma链。每个帖子下的子链用来保存评论信息。共识机制来确保访问控制的执行。对前一个块的随机化承诺(有父链提供的随机数)，需要保存在区块头中。定期执行归约函数来计算置顶和其他的统计数据。

个人用户可以使用计算机将数据和软件下载到本地。提交数据需要支付手续费，从而通过激励的方式来保证数据被写入链上，为了保证数据可用性而下载旧的区块也需要一定的费用。

为了浏览某个具体的帖子，用户需要校验根链上的承诺(commitment)，随后再通过最顶端的父节点(比如说查找一周前的数据，需要向前回溯n个块)找到子版块所对应的账户状态树。随后连接到一个DHT网络来查找包含子版块的节点，并从链头开始下载子版块数据(根据需要，可能需要向前回溯n个块来做校验)并浏览帖子列表，同时以轻客户端模式下载状态树以及相关带有评论帖子的原始数据。用户仅需关注与其相关的Plasma链的部分内容(仅下载与其相关的帖子和部分子版块)。

以上是在区块链上完成带有部分计算量的数据存储应用的简单示例。验证节点可以对所有节点进行验证，也可以将节点进行分片验证。如果分片进行过多，则需要考虑信息可用性的问题。可以缓解以上问题的解决方案之一就是将子链的全部控制权授予子版块拥有者。

### 10.2 去中心化的交易所

前文讨论的Reddit的克隆，虽然可以很好地展示如何在区块链上运行Web应用，但是除了在网站统计之外并没有充分很好地利用MapReduce操作的优势。

去中心化交易所的示例表明可以牺牲低延时来换取较高的计算能力。由于交易中存在很多状态，因此在输出中采用账户模型而不是UXTO模型，或者用一个大的位图来表示每一步状态机中的变化，而不是仅仅在位图中使用布尔值来标识可花费的部分。

与子版块的结构类似，子链以树状进行组织，每个子链对应一个交易对。每个子链都是有多个链组成的树状结构(对于低活性的交易，仅用一个Plasma链来表示，对于高活性的交易，则可能存在多条子链)。每条链都进行担保交易，每轮的交易额由担保额度决定。

首先，确保子链中有余额，这相当于将Plasma链做为基础的支付链。

其次，直接将订单发送至子链。做为提交给父链承诺的一部分，所有订单合并成一个订单簿的merkle式承诺，并以此链来表示单个订单。递归执行以上步骤，到最顶层的Plasma节点后，则可以把所有的子链上的订单簿归约到一个订单簿。接到到订单后，订单窗口关闭，交易以批处理的方式完成。

以上归约完成后，结果被提交到根链上，随后通过映射步骤重新对子链进行分配。父链会通知子链以什么方式来分配订单。假设子链可以查看订单(这里暗示可以在映射过程中监控父链)，则他们可以在映射过程中验证分配是否正确执行。在获得父链分配订单后，继续在其子链上递归的执行以上分配。

分配完成后，最终的归约过程将所有资金的更新提交到一个区块并将区块头提交给它的父节点。

在价格变动比较大的情况下，可以使用多轮MapReduce进行进一步的优化(允许高精度定价)，这种方法可以有效提升交易量。理论上来讲，如果在交易速度上做一定的妥协，可以把将其转换为一个完全由根链验证并背书的顺序执行的交易所，那么该框架可以容纳全世界的交易。

这种方法对于多种金融交易和计算都是很有帮助的。



### 10.3 去中心化的电子邮件

为了创建去中心化的电子邮件应用，需要在Plasma区块链中设立对应的账户，并在接收邮件时进行支付(将信息插入链中)。提交到链上的信息使用公钥加密。通过强制执行来确保不明身份的实体在发送邮件时必须支付手续费，后续可以采用zk-SNARKS来进一步优化。父链中包含一个子链的目录，并执行支付。以上为一个简要的设计方案。

### 10.4 去中心化的CDN

基于Plasma可以实现一个去中心化的CDN，方法与以太坊的分片天类似。将每一个子链作为一个分片。设定一个随机的信标(可以是根区块哈希或者其他的内容)。将数据在每n个块之间进行分布。父链负责对分布的数据生成承诺。其他链仅仅是保留存档文件。一旦出现数据缺失，保留存档的的链会得到奖励。为了鼓励传播，只有在其他分片获得数据的情况下才进行奖励。系统的健壮性源于对流量的需求，健壮性越强，分片在某一个时刻需要存储的数据越多。整个设计的关键在于将存储视为带宽的一个功能。不再将数据视为磁盘上的静止内容，而是有目的循环流转，听起来颇有道家风范。

为了下载数据，需要先验证父链的分片以及随机信标来确定哪些分片包含要获取的数据，接着通过DHT来确认具体哪些节点保存数据，随后进行下载。


### 10.5 私有链

参与者没有义务将链上的数据披露给其他人(尽管没有组织数据被公开的机制)，如果参与者希望在根链下运行一些私有区块链，也是可以做到的。这就像对局域网/互联网进行分离一样。交易可以在本地的私有链上进行，也可以与公有链进行通讯和金融交易。